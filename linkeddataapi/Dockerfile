FROM openphacts/ops-linkeddataapi:2.1.0

MAINTAINER Randy Kerber <randy@d2discovery.com>
## Dockerfile extends Docker Hub image openphacts/ops-linkeddataapi
## by: Stian Soiland-Reyes <soiland-reyes@cs.manchester.ac.uk>
## at: https://hub.docker.com/r/openphacts/ops-linkeddataapi/
## or: https://github.com/openphacts/OPS_LinkedDataApi/blob/docker/Dockerfile

WORKDIR /var/www/html

## For IMS call, replace deprecated command /mapBySetRDF with /mapUriRDF
RUN sed -i "s|'IMS_MAP_ENDPOINT'.*|'IMS_MAP_ENDPOINT', 'http://ims:8080/QueryExpander/mapUriRDF');|" deployment.settings.php

# SPARQL server
#RUN sed -i "s,<http://[^>]*/sparql/>,<http://localhost:8890/sparql/>,g" api-config-files/*ttl
RUN sed -i "s,<http://[^>]*/sparql/>,<http://alpha.openphacts.org:8890/sparql/>,g" api-config-files/*ttl

## Turn off memcache caching of API calls (for development and testing)

RUN sed -i "s/CACHE_OFF.*/CACHE_OFF', 1);/" deployment.settings.php
